{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- CSRF Token for AJAX requests -->
    <meta name="csrf-token" content="{{ csrf_token }}">

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
      crossorigin="anonymous"
    />

    <!--FontAwesome CDN-->
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"
      integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu"
      crossorigin="anonymous"
    />
    
    <!--Chart.js CDN-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--Custom CSS-->
    <link rel="stylesheet" href="{% static '/style.css' %}" />
    <title>{% block title %}{% endblock %}</title>
  </head>

  <body>
    {% include 'partials/nav.html' %}

    <div class="container">{% block content %} {% endblock %}</div>

    <!-- Hidden CSRF token for JavaScript access -->
    <input type="hidden" id="csrfToken" value="{{ csrf_token }}">

    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
      crossorigin="anonymous"
    ></script>

    <!-- CSRF Token Utility Script -->
    <script>
      // Function to get CSRF token from cookie
      function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== '') {
              const cookies = document.cookie.split(';');
              for (let i = 0; i < cookies.length; i++) {
                  const cookie = cookies[i].trim();
                  if (cookie.substring(0, name.length + 1) === (name + '=')) {
                      cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                      break;
                  }
              }
          }
          return cookieValue;
      }

      // Get CSRF token from hidden input or cookie
      function getCSRFToken() {
          const hiddenToken = document.getElementById('csrfToken');
          if (hiddenToken && hiddenToken.value) {
              return hiddenToken.value;
          }
          return getCookie('csrftoken');
      }

      // Set up AJAX to include CSRF token by default
      const csrftoken = getCSRFToken();

      // For jQuery AJAX requests
      $.ajaxSetup({
          beforeSend: function(xhr, settings) {
              if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                  xhr.setRequestHeader("X-CSRFToken", csrftoken);
              }
          }
      });

      // For fetch API
      const originalFetch = window.fetch;
      window.fetch = function(...args) {
          const [url, options = {}] = args;
          
          // Only add CSRF token for same-origin POST, PUT, PATCH, DELETE requests
          if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(options.method || 'GET') && 
              !options.credentials || options.credentials === 'same-origin') {
              
              options.headers = {
                  ...options.headers,
                  'X-CSRFToken': csrftoken
              };
          }
          
          return originalFetch(url, options);
      };
    </script>

    <!-- Additional custom scripts block -->
    {% block extra_scripts %}{% endblock %}
    
  </body>
</html>